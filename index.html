<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Color App</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                text-align: center;
                background: #e9f1fb;
                margin: 0;
                padding: 40px 20px;
            }
            #login,
            #app {
                display: none;
            }
            #login {
                margin: 40% auto;
            }
            input {
                padding: 10px;
                font-size: 14px;
                width: 250px;
                margin: 10px auto;
                display: block;
                border: 2px solid #007bff;
                border-radius: 8px;
            }
            button {
                font-size: 16px;
                margin-top: 20px;
                padding: 10px 20px;
                border: none;
                border-radius: 8px;
                background-color: #007bff;
                color: white;
                cursor: pointer;
            }
            table {
                margin: 30px auto;
                border-collapse: collapse;
                width: 90%;
                background: white;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }
            th,
            td {
                border: 1px solid #ddd;
                padding: 6px;
                font-size: 12px;
                text-align: center;
            }
            th {
                background: #007bff;
                color: white;
            }
            .number-prediction {
                width: 80%;
                margin: 20px auto;
                padding: 15px;
                background: #fff;
                border: 2px solid #007bff;
                border-radius: 10px;
                display: flex;
                justify-content: center;
                gap: 10px;
                overflow-x: auto;
            }
            .color-prediction {
                width: 90%;
                height: 20vh;
                margin: 20px auto;
                padding: 15px;
                background: #fff;
                border: 2px solid #007bff;
                border-radius: 10px;
                display: flex;
                justify-content: center;
                flex-direction: column;
                align-items: center;

                gap: 10px;
            }
            #color-sequence-display,
            #predicted-color-display {
                width: 80%;
                font-size: 1rem;
                font-weight: bold;
                padding: 12px;
                border-radius: 10px;
                margin: 10px 0;
                text-align: center;
                transition: all 0.3s ease;
            }

            .column {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            .circle {
                width: 20px;
                height: 20px;
                border-radius: 50%;
                display: flex;
                justify-content: center;
                align-items: center;
                color: white;
            }
        </style>
    </head>
    <body>
        <div id="login">
            <h1>Enter Access Key</h1>
            <input type="password" id="keyInput" placeholder="Enter key" />
            <button onclick="checkKey()">Submit</button>
            <a href="https://t.me/Saw1233" target="_blank">
                <button style="background-color: aqua; color: #000">
                    Get key
                </button>
            </a>
            <p id="error" style="color: red"></p>
        </div>
        <div id="app">
            <h1>Color App</h1>
            <input
                type="text"
                id="periodInput"
                placeholder="Enter last 3 digits of period number"
            />
            <input type="text" id="numberInput" placeholder="Enter number" />
            <div class="color-prediction">
                <div id="color-sequence-display"></div>
                <div id="predicted-color-display"></div>
            </div>
            <div class="number-prediction"></div>

            <table id="dataTable">
                <thead>
                    <tr>
                        <th>Period</th>
                        <th>Number</th>
                        <th>Color</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <script>
            document.getElementById("login").style.display = "block";
            let periodNumber = null;
            let entryCount = 0;
            let allData = [];
            let numberColumns = [];

            function checkKey() {
                const key = document.getElementById("keyInput").value;
                if (key === "336699") {
                    document.getElementById("login").style.display = "none";
                    document.getElementById("app").style.display = "block";
                } else {
                    document.getElementById("error").textContent =
                        "Invalid key. Try again.";
                }
            }

            document.addEventListener("keydown", function (event) {
                if (event.key === "Enter") {
                    submitData();
                }
            });

            function submitData() {
                const period = document
                    .getElementById("periodInput")
                    .value.trim();
                const number = document
                    .getElementById("numberInput")
                    .value.trim();

                const isValidPeriod = /^\d{3}$/.test(period);
                const isValidNumber = /^[0-9]$/.test(number);

                if ((isValidPeriod || periodNumber !== null) && isValidNumber) {
                    if (periodNumber === null) {
                        periodNumber = period.padStart(3, "0");
                        document.getElementById("periodInput").style.display =
                            "none";
                    } else {
                        periodNumber = (parseInt(periodNumber) + 1)
                            .toString()
                            .padStart(3, "0");
                    }

                    addRow(periodNumber, number);
                    updateNumberPredictionContainer(number);
                    document.getElementById("numberInput").value = "";
                } else {
                    document.getElementById("numberInput").value = "";
                }
            }

            function updateNumberPredictionContainer(number) {
                const isOdd = number % 2 !== 0;
                const color = isOdd ? "green" : "red";

                if (
                    numberColumns.length > 0 &&
                    numberColumns[numberColumns.length - 1].color === color
                ) {
                    numberColumns[numberColumns.length - 1].numbers.push(
                        number
                    );
                } else {
                    numberColumns.push({ color: color, numbers: [number] });
                }

                if (numberColumns.length > 20) {
                    numberColumns.shift();
                }

                renderNumberPredictionColumns();
            }

            function renderNumberPredictionColumns() {
                const container = document.querySelector(".number-prediction");
                container.innerHTML = "";

                numberColumns.forEach((column) => {
                    const colDiv = document.createElement("div");
                    colDiv.classList.add("column");
                    column.numbers.forEach((num) => {
                        const numDiv = document.createElement("div");
                        numDiv.classList.add("circle");
                        numDiv.textContent = num;
                        numDiv.style.backgroundColor = column.color;
                        colDiv.appendChild(numDiv);
                    });
                    container.appendChild(colDiv);
                });
            }

            function addRow(period, number) {
                let color = "",
                    numberColor = "";

                if (parseInt(number) === 0) {
                    color = "ðŸ”´ðŸŸ£";
                    numberColor = "red";
                } else if (parseInt(number) === 5) {
                    color = "ðŸŸ¢ðŸŸ£";
                    numberColor = "green";
                } else if (parseInt(number) % 2 === 0) {
                    color = "ðŸ”´";
                    numberColor = "red";
                } else {
                    color = "ðŸŸ¢";
                    numberColor = "green";
                }

                const table = document
                    .getElementById("dataTable")
                    .getElementsByTagName("tbody")[0];
                const newRow = table.insertRow(0);
                const periodCell = newRow.insertCell(0);
                const numberCell = newRow.insertCell(1);
                const colorCell = newRow.insertCell(2);

                periodCell.textContent = period;
                numberCell.textContent = number;
                numberCell.style.color = numberColor;
                colorCell.textContent = color;

                numberCell.addEventListener("click", function () {
                    editNumber(this, colorCell);
                });

                entryCount++;
                allData.unshift({ period, number });

                if (entryCount > 50) {
                    table.deleteRow(-1);
                    allData.pop();
                }

                calculateNextResults();
            }

            function calculateNextResults() {
                if (allData.length < 50) {
                    renderNumberPredictionColumns();
                    return;
                }

                const targetNumber = allData[0].number; // Latest entry's number
                console.log("Target Number:", targetNumber);

                const previousMatches = [];

                // Loop through all previous data (excluding the first one)
                for (let i = 1; i < allData.length - 1; i++) {
                    if (allData[i].number === targetNumber) {
                        const currentPeriod = parseInt(allData[i].period);
                        const nextPeriod = (currentPeriod + 1)
                            .toString()
                            .padStart(3, "0");

                        const nextEntry = allData.find(
                            (entry) => entry.period === nextPeriod
                        );
                        if (nextEntry) {
                            previousMatches.push({
                                period: allData[i].period,
                                number: allData[i].number,
                                next: nextEntry.number,
                            });
                        }
                    }
                }

                console.log(
                    "Previous Matches:",
                    previousMatches.slice().reverse()
                );

                const nextResults = previousMatches.map((match) =>
                    parseInt(match.next)
                );
                const colorSequence = nextResults.map((num) =>
                    [0, 2, 4, 6, 8].includes(num) ? "ðŸ”´" : "ðŸŸ¢"
                );

                console.log(colorSequence);

                const colorRules = [
                    // Add your updated color rules here:
                    ["ðŸ”´", "ðŸŸ¢", "ðŸ”´"],
                    ["ðŸŸ¢", "ðŸ”´", "ðŸŸ¢"],
                    ["ðŸŸ¢", "ðŸŸ¢", "ðŸŸ¢", "ðŸŸ¢"],
                    ["ðŸ”´", "ðŸ”´", "ðŸ”´", "ðŸ”´"],
                    ["ðŸŸ¢", "ðŸ”´", "ðŸŸ¢", "ðŸŸ¢"],
                    ["ðŸ”´", "ðŸŸ¢", "ðŸ”´", "ðŸ”´"],
                    ["ðŸ”´", "ðŸ”´", "ðŸŸ¢", "ðŸŸ¢"],
                    ["ðŸŸ¢", "ðŸŸ¢", "ðŸ”´", "ðŸ”´"],
                    ["ðŸ”´", "ðŸŸ¢", "ðŸŸ¢", "ðŸŸ¢"],
                    ["ðŸŸ¢", "ðŸ”´", "ðŸ”´", "ðŸ”´"],
                    ["ðŸŸ¢", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´", "ðŸ”´"],
                    ["ðŸ”´", "ðŸ”´", "ðŸ”´", "ðŸŸ¢", "ðŸŸ¢"],
                    ["ðŸ”´", "ðŸŸ¢", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´"],
                    ["ðŸŸ¢", "ðŸ”´", "ðŸ”´", "ðŸ”´", "ðŸŸ¢"],
                    ["ðŸŸ¢", "ðŸŸ¢", "ðŸ”´", "ðŸ”´", "ðŸŸ¢"],
                    ["ðŸ”´", "ðŸ”´", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´"],
                    ["ðŸ”´", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´", "ðŸŸ¢"],
                    ["ðŸŸ¢", "ðŸ”´", "ðŸ”´", "ðŸŸ¢", "ðŸ”´"],
                    ["ðŸŸ¢", "ðŸŸ¢", "ðŸ”´", "ðŸŸ¢", "ðŸ”´"],
                    ["ðŸ”´", "ðŸ”´", "ðŸŸ¢", "ðŸ”´", "ðŸŸ¢"],
                    ["ðŸŸ¢", "ðŸ”´", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´"],
                    ["ðŸ”´", "ðŸŸ¢", "ðŸ”´", "ðŸ”´", "ðŸŸ¢"],
                    ["ðŸŸ¢", "ðŸŸ¢", "ðŸŸ¢", "ðŸŸ¢", "ðŸŸ¢"],
                    ["ðŸ”´", "ðŸ”´", "ðŸ”´", "ðŸ”´", "ðŸ”´"],
                    ["ðŸ”´", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´", "ðŸŸ¢", "ðŸ”´"],
                    ["ðŸŸ¢", "ðŸ”´", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´", "ðŸŸ¢"],
                    ["ðŸŸ¢", "ðŸŸ¢", "ðŸ”´", "ðŸŸ¢", "ðŸ”´", "ðŸ”´"],
                    ["ðŸ”´", "ðŸ”´", "ðŸŸ¢", "ðŸ”´", "ðŸŸ¢", "ðŸŸ¢"],
                    ["ðŸŸ¢", "ðŸ”´", "ðŸŸ¢", "ðŸ”´", "ðŸ”´", "ðŸŸ¢"],
                    ["ðŸ”´", "ðŸŸ¢", "ðŸ”´", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´"],
                    ["ðŸ”´", "ðŸ”´", "ðŸ”´", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´"],
                    ["ðŸŸ¢", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´", "ðŸ”´", "ðŸŸ¢"],
                    ["ðŸŸ¢", "ðŸ”´", "ðŸ”´", "ðŸŸ¢", "ðŸŸ¢", "ðŸŸ¢"],
                    ["ðŸ”´", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´", "ðŸ”´", "ðŸ”´"],
                    ["ðŸŸ¢", "ðŸ”´", "ðŸ”´", "ðŸ”´", "ðŸŸ¢", "ðŸ”´", "ðŸ”´", "ðŸŸ¢"],
                    ["ðŸ”´", "ðŸŸ¢", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´"],
                    ["ðŸ”´", "ðŸ”´", "ðŸ”´", "ðŸŸ¢", "ðŸ”´", "ðŸ”´", "ðŸŸ¢", "ðŸ”´"],
                    ["ðŸŸ¢", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´", "ðŸŸ¢"],
                    ["ðŸŸ¢", "ðŸ”´", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´", "ðŸŸ¢", "ðŸŸ¢", "ðŸŸ¢"],
                    ["ðŸ”´", "ðŸŸ¢", "ðŸ”´", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´", "ðŸŸ¢", "ðŸ”´"],
                    ["ðŸ”´", "ðŸ”´", "ðŸ”´", "ðŸ”´", "ðŸ”´", "ðŸ”´", "ðŸŸ¢"],
                    ["ðŸŸ¢", "ðŸŸ¢", "ðŸŸ¢", "ðŸŸ¢", "ðŸŸ¢", "ðŸŸ¢", "ðŸ”´"],
                ];

                let predictedColor = "âšª";

                // Check the color sequence against the rules
                for (let rule of colorRules) {
                    for (let start = 0; start <= rule.length - 2; start++) {
                        const slice = rule.slice(
                            start,
                            start + colorSequence.length
                        );
                        if (slice.join("") === colorSequence.join("")) {
                            const nextIndex = start + colorSequence.length;
                            if (nextIndex < rule.length) {
                                predictedColor = rule[nextIndex];
                            } else {
                                // Loop continuation
                                const loopedNextIndex = nextIndex % rule.length;
                                predictedColor = rule[loopedNextIndex];
                            }
                            console.log(
                                "ðŸ“Œ Rule matched (continuing):",
                                rule.join(" ")
                            );
                            break;
                        }
                    }
                    if (predictedColor !== "âšª") break; // Exit outer loop if matched
                }

                console.log("ðŸ”® Predicted Color:", predictedColor);
                // Update HTML with color sequence and predicted color
                // Update color sequence display
                document.getElementById("color-sequence-display").innerHTML =
                    "Color Sequence: " + colorSequence.join(" ");

                // Update predicted color display based on value
                const predictedDiv = document.getElementById(
                    "predicted-color-display"
                );

                if (predictedColor === "ðŸ”´") {
                    predictedDiv.style.backgroundColor = "red";
                    predictedDiv.style.color = "white";
                    predictedDiv.innerHTML = "JOIN : RED";
                } else if (predictedColor === "ðŸŸ¢") {
                    predictedDiv.style.backgroundColor = "green";
                    predictedDiv.style.color = "white";
                    predictedDiv.innerHTML = "JOIN : GREEN";
                } else {
                    predictedDiv.style.backgroundColor = "#ccc";
                    predictedDiv.style.color = "#000";
                    predictedDiv.innerHTML = "NO PREDICTION";
                }

                renderPredictionResults(
                    previousMatches.reverse(),
                    colorSequence.reverse(),
                    predictedColor
                );
            }

            function renderPredictionResults(
                matches,
                colorSequence,
                predictedColor
            ) {
                const predictionContainer =
                    document.querySelector(".number-prediction");
                let matchesTableHTML = "";

                if (matches.length > 0) {
                    matchesTableHTML = `
                    <h3>Matches</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Period</th>
                                <th>Number</th>
                                <th>Next Result</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${matches
                                .map(
                                    (match) => `
                                <tr>
                                    <td>${match.period}</td>
                                    <td>${match.number}</td>
                                    <td>${match.next}</td>
                                </tr>`
                                )
                                .join("")}
                        </tbody>
                    </table>
                    <h3>Color Sequence of Next Results: ${colorSequence.join(
                        " "
                    )}</h3>
                `;
                } else {
                    matchesTableHTML = `<h3>No previous matches found for the number ${allData[49].number}.</h3>`;
                }

                predictionContainer.innerHTML = `
                ${matchesTableHTML}
                <h3>Predicted Next Color: ${predictedColor}</h3>
            `;
            }
        </script>
    </body>
</html>
